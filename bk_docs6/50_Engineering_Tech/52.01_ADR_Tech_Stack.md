---
title: "ADR 001: MVP技術スタック選定"
type: technical
status: accepted
role: TechLead
tags: [adr, architecture, tech-stack]
---

# ADR 001: MVP技術スタック選定

> Architecture Decision Record (アーキテクチャ決定記録)
> **利用職種**: TechLead, Engineer, EM

---

## メタデータ

- **Status**: Accepted
- **Date**: 2026-01-22
- **Deciders**: TechLead, CTO
- **Supersedes**: なし
- **Superseded by**: なし

---

## Context and Problem Statement

astranote MVPの開発において、以下の技術的要件を満たす技術スタックを選定する必要がある。

### ビジネス的背景

- WEB小説執筆に特化したエディタとして、**オフライン完結**での動作が必須
- 将来的にデスクトップアプリとして配布し、マルチプラットフォーム（Windows, macOS, Linux）に対応する
- MVP段階では開発速度を優先し、小規模チームでも実装可能な技術を選択する必要がある

### 技術的背景

- **必須要件**:
  - オフライン動作（ブラウザ内でデータ完結）
  - IndexedDBでの自動保存
  - リアルタイムプレビュー（入力と同期）
  - タイプライター・スクロール（現在の行を画面中央に固定）
  - ルビ・傍点のリアルタイム表示
  - 10万文字までの原稿でも快適に動作
- **制約**:
  - バックエンドAPIは不要（MVP段階ではローカルストレージのみ）
  - 外部サービス連携なし
  - 既存のMarkdown記法に近い独自記法（`｜《》` など）のパース

---

## Considered Options

### 1. フロントエンドフレームワーク

#### Option 1-A: **React + TypeScript**

- **説明**: 最も人気のあるUIライブラリ。エコシステムが豊富。
- **Pros**:
  - エディタライブラリの選択肢が豊富（Draft.js, Slate.js, TipTap）
  - TypeScriptとの相性が良く、型安全性が高い
  - Tauriとの統合が実績豊富
  - コミュニティが大きく、問題解決が容易
- **Cons**:
  - バンドルサイズが大きい
  - 学習コストがやや高い

#### Option 1-B: **Vue 3 + TypeScript**

- **説明**: シンプルで学習コストが低いフレームワーク。
- **Pros**:
  - 学習コストが低く、開発速度が速い
  - リアクティブシステムが直感的
  - バンドルサイズが小さい
- **Cons**:
  - エディタライブラリの選択肢がReactより少ない
  - TypeScriptとの統合がReactより弱い

#### Option 1-C: **Svelte + TypeScript**

- **説明**: コンパイル時に最適化され、ランタイムが軽量。
- **Pros**:
  - バンドルサイズが最小
  - パフォーマンスが最高
  - コードがシンプルで読みやすい
- **Cons**:
  - エコシステムがReact/Vueより小さい
  - エディタライブラリの選択肢が少ない
  - チームの学習コストが高い

---

### 2. エディタライブラリ

#### Option 2-A: **TipTap**

- **説明**: ProseMirrorベースのリッチテキストエディタ。拡張性が高い。
- **Pros**:
  - モダンで拡張しやすいAPI
  - Markdown記法のカスタマイズが容易
  - TypeScript完全対応
  - ドキュメントが充実
- **Cons**:
  - 学習コストがやや高い
  - バンドルサイズがやや大きい

#### Option 2-B: **Slate.js**

- **説明**: Reactベースのカスタマイズ可能なエディタフレームワーク。
- **Pros**:
  - 完全なカスタマイズが可能
  - React専用で統合が容易
  - プラグインアーキテクチャ
- **Cons**:
  - 学習コストが非常に高い
  - ドキュメントが不十分
  - 開発速度が遅くなる可能性

#### Option 2-C: **ContentEditable（素のブラウザAPI）**

- **説明**: ブラウザのネイティブAPIを直接使用。
- **Pros**:
  - 最小限の依存関係
  - バンドルサイズが最小
  - パフォーマンスが最高
- **Cons**:
  - ブラウザ間の挙動の違いが大きい
  - カーソル制御が複雑
  - 開発コストが非常に高い

---

### 3. デスクトップアプリ化

#### Option 3-A: **Tauri V2**

- **説明**: Rustベースの軽量なデスクトップアプリフレームワーク。
- **Pros**:
  - バンドルサイズが極めて小さい（Electronの1/10以下）
  - メモリ使用量が少ない
  - セキュリティが高い（サンドボックス化）
  - Windows, macOS, Linux, iOS, Androidに対応
  - 起動速度が速い
- **Cons**:
  - Rustの知識が必要（プラグイン開発時）
  - エコシステムがElectronより小さい

#### Option 3-B: **Electron**

- **説明**: Node.jsベースの最も人気のあるデスクトップアプリフレームワーク。
- **Pros**:
  - エコシステムが最も豊富
  - 開発実績が多く、問題解決が容易
  - Node.jsの全機能が使える
- **Cons**:
  - バンドルサイズが非常に大きい（100MB以上）
  - メモリ使用量が多い
  - 起動速度が遅い

#### Option 3-C: **PWA（Progressive Web App）のみ**

- **説明**: ブラウザで動作するWebアプリ（デスクトップアプリ化しない）。
- **Pros**:
  - 配布が容易（URLのみ）
  - マルチプラットフォーム対応が自動
  - 更新が容易
- **Cons**:
  - ネイティブ機能へのアクセスが制限される
  - オフライン対応が複雑
  - アプリストアへの配布が不可

---

## Decision Outcome

**React + TypeScript + TipTap + Tauri V2** を採用する。

### 理由 (Rationale)

1. **React**: エディタライブラリの選択肢が最も豊富で、TipTapやSlate.jsとの統合実績がある。TypeScriptとの相性も良く、型安全性を確保できる。
2. **TipTap**: Markdown記法のカスタマイズが容易で、ルビ・傍点の独自記法を実装しやすい。ドキュメントが充実しており、開発速度を維持できる。
3. **Tauri V2**: バンドルサイズと起動速度がElectronより圧倒的に優れており、ユーザー体験が向上する。マルチプラットフォーム対応も容易。将来的にモバイル対応も視野に入れられる。
4. **TypeScript**: 型安全性により、開発時のバグを削減し、リファクタリングを容易にする。

---

## Consequences

### Positive (利点)

- **高速な開発**: Reactとエコシステムにより、MVP開発が迅速に進む
- **軽量なアプリ**: Tauriにより、バンドルサイズが小さく、起動速度が速い
- **型安全性**: TypeScriptにより、バグが減少し、保守性が向上
- **拡張性**: TipTapのプラグインシステムにより、将来的な機能追加が容易
- **マルチプラットフォーム**: Tauri V2により、Windows, macOS, Linux, iOS, Androidに対応可能

### Negative (欠点)

- **Rustの学習コスト**: Tauriのプラグイン開発にはRustの知識が必要（ただし、MVP段階では不要）
- **エコシステムの小ささ**: TauriはElectronよりエコシステムが小さく、問題解決に時間がかかる可能性
- **TipTapの学習コスト**: ProseMirrorの概念を理解する必要がある

### Risks (リスク)

- **リスク1: TipTapでのルビ実装の難易度**: 独自記法のパースが複雑になる可能性
  - **対策**: MVP段階ではプレビューのみでルビを表示し、エディタ内表示はv2で実装
- **リスク2: Tauri V2の安定性**: まだ比較的新しいバージョンである
  - **対策**: 初期段階ではPWAとしても動作するように設計し、Tauriはオプショナルに
- **リスク3: 10万文字でのパフォーマンス**: 大量の文字列の処理が重くなる可能性
  - **対策**: 仮想スクロール（Virtualization）の導入を検討

---

## Implementation Notes

### フロントエンド構成

```
astranote/
├── src/
│   ├── components/       # Reactコンポーネント
│   │   ├── Editor/       # エディタ関連
│   │   ├── EpisodeList/  # エピソードリスト
│   │   └── Preview/      # プレビュー
│   ├── hooks/            # カスタムフック
│   ├── stores/           # 状態管理（Zustand or Jotai）
│   ├── utils/            # ユーティリティ関数
│   └── types/            # TypeScript型定義
├── src-tauri/            # Tauriバックエンド（Rust）
└── public/               # 静的ファイル
```

### 状態管理

- **Zustand** または **Jotai** を採用（軽量で学習コストが低い）
- Redux Toolkitは不要（MVPでは過剰）

### データ永続化

- **Dexie.js** を使用してIndexedDBを簡単に操作
- 5秒ごとに自動保存（`debounce` を使用）

### ルビ・傍点のパース

- TipTapのカスタムノード/マークを作成
- 正規表現で `｜文字《ルビ》` を検出し、`<ruby>` タグに変換

### タイプライター・スクロール

- TipTapの `onUpdate` フックで現在のカーソル位置を取得
- `scrollIntoView({ behavior: 'smooth', block: 'center' })` で中央に固定

---

## 技術スタック詳細

| カテゴリ                 | 技術           | バージョン | 用途                           |
| ------------------------ | -------------- | ---------- | ------------------------------ |
| **フロントエンド**       | React          | 18.x       | UIライブラリ                   |
|                          | TypeScript     | 5.x        | 型安全性                       |
|                          | Vite           | 5.x        | ビルドツール                   |
| **エディタ**             | TipTap         | 2.x        | リッチテキストエディタ         |
|                          | ProseMirror    | -          | TipTapの基盤                   |
| **状態管理**             | Zustand        | 4.x        | グローバル状態管理             |
| **データ永続化**         | Dexie.js       | 3.x        | IndexedDBラッパー              |
| **スタイリング**         | Tailwind CSS   | 3.x        | ユーティリティCSS              |
| **デスクトップ化**       | Tauri          | 2.x        | デスクトップアプリフレームワーク |
| **リント・フォーマット** | ESLint         | 9.x        | リント                         |
|                          | Prettier       | 3.x        | コードフォーマット             |
| **テスト**               | Vitest         | 1.x        | ユニットテスト                 |
|                          | Playwright     | 1.x        | E2Eテスト                      |

---

## Links and References

- [React公式ドキュメント](https://react.dev/)
- [TipTap公式ドキュメント](https://tiptap.dev/)
- [Tauri V2公式ドキュメント](https://v2.tauri.app/)
- [Dexie.js公式ドキュメント](https://dexie.org/)
- [Zustand公式ドキュメント](https://zustand-demo.pmnd.rs/)

---

## 関連ドキュメント

- [PRD: MVP](../30_Definition_Requirements/31.01_PRD_MVP.md) - MVP要件定義
- [UI Spec: エディタ](../40_Design_UX/41.01_UI_Spec_Editor.md) - UI仕様
- [開発標準](55.00_Development_Standards.md) - 開発標準とコーディング規約

---

## 次のステップ

1. **プロトタイプの作成**: React + TipTapで基本的なエディタのプロトタイプを作成し、技術的な実現可能性を検証
2. **パフォーマンステスト**: 10万文字の原稿でのパフォーマンスを測定
3. **Tauri統合**: プロトタイプが完成したら、Tauriでデスクトップアプリ化を検証

---

## 変更履歴

| 日付       | 変更者 | 変更内容                                       |
| ---------- | ------ | ---------------------------------------------- |
| 2026/01/28 | Salaim | bkから統合、statusをacceptedに更新（297行）   |
| 2026-01-22 | Claude | 初版作成（MVP技術スタック選定）                |
