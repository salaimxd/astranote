---
title: "技術仕様書：バックエンド"
type: technical
status: active
role: Engineer
tags: [techspec, backend, cloudflare, hono, api]
---

# 技術仕様書：バックエンド

> **テンプレート利用ガイド**
> バックエンド詳細設計書です。
> **利用職種**: Backend Engineer


## 概要
Astranoteのバックエンドは、**Cloudflare Workers** 上で動作する **Hono** フレームワークを用いて構築する。サーバーレスで、エッジでの低遅延処理を実現する。


## バックエンド設計

### 技術スタック
- **Runtime**: Cloudflare Workers
- **Framework**: Hono (Web Standards準拠で高速)
- **ORM**: Drizzle ORM
- **Database**: Cloudflare D1 (SQLite)
- **Validation**: Zod
- **Auth**: Lucia Auth

### サービス構成 (Service Architecture)
Hono を使用し、モノリスとしてデプロイするが、内部は機能ごとのモジュール構成とする。

```text
src/
├── routes/
│   ├── auth.ts          # 認証関連
│   ├── novels.ts        # 小説、章CRUD
│   ├── users.ts         # プロフィール
│   └── translate.ts     # 翻訳キュー処理
├── db/
│   └── schema.ts        # Drizzle スキーマ
├── services/
│   └── translation.ts   # AI翻訳ロジック
└── middleware/
    └── auth.ts          # JWT/Session検証
```


## 主要ロジック

### 翻訳処理フロー
1. 作家が日本語で章を投稿 (`POST /novels/:id/chapters`)
2. APIが章をDBに保存 (`status: processing`)
3. 非同期でAI翻訳サービス (Gemini 2.0 Flash / Claude) を呼び出し
4. 翻訳結果を保存し、ステータスを更新 (`status: published`)


## エラーハンドリング
統一されたエラーレスポンス形式（RFC 7807 Problem Details for HTTP APIs 準拠）を使用。

```json
{
  "type": "about:blank",
  "title": "Validation Error",
  "status": 400,
  "detail": "Title is required",
  "instance": "/v1/novels"
}
```

## 関連ドキュメント
- [51.01_TechSpec_Architecture.md](51.01_TechSpec_Architecture.md)
- [51.01_TechSpec_Auth.md](51.01_TechSpec_Auth.md)
