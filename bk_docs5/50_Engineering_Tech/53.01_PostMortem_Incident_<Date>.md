# 障害報告書 (Post-Mortem) - [日付]

> **テンプレート利用ガイド**
> 障害発生後の振り返りと再発防止策をまとめます。責任追及ではなく、学びと改善に焦点を当ててください。
> **利用職種**: Engineer, EM, SRE, 全チーム

---

## 1. 概要 (Executive Summary)
- **インシデント番号**: INC-xxxx
- **発生日時**: YYYY/MM/DD HH:MM - HH:MM (JST)
- **検知日時**: YYYY/MM/DD HH:MM
- **復旧日時**: YYYY/MM/DD HH:MM
- **影響範囲**: [例: 全ユーザーのログイン不可]
- **影響ユーザー数**: x,xxx名 (全体のxx%)
- **重大度**: Critical / High / Medium / Low
- **インシデントオーナー**: Engineer Name

---

## 2. タイムライン (Timeline)
| 時刻 | イベント | 担当者 |
| --- | --- | --- |
| 14:00 | アラート検知（エラーレート急増） | 自動検知 |
| 14:05 | エンジニアが調査開始 | Alice |
| 14:15 | 原因特定：DB接続数枯渇 | Alice |
| 14:30 | 一時対応：コネクションプール設定変更 | Bob |
| 14:45 | サービス再起動 | Bob |
| 15:00 | 復旧確認、モニタリング継続 | Alice, Bob |
| 15:30 | 安定稼働確認、インシデントクローズ | EM |

---

## 3. 影響 (Impact)
### ビジネスインパクト
- **売上損失**: 推定 x万円
- **顧客からの問い合わせ**: xx件
- **解約**: x件 (うち障害が理由: x件)

### ユーザーインパクト
- [影響を受けたユーザーの行動、不満]

### SLA違反
- 月間SLA目標: 99.9% (ダウンタイム 43分まで)
- 今回のダウンタイム: 90分
- ❌ SLA違反

---

## 4. 根本原因 (Root Cause)
<!-- 技術的な詳細 -->
新リリースしたバッチ処理がDB接続を大量に消費し、明示的にCloseしていない箇所があった。加えて、コネクションプールの最大値設定が、スパイク時の負荷に対して不十分だった。

### 原因の連鎖 (5 Whys)
1. **Why**: なぜログインできなくなったのか？
   - Answer: DB接続が枯渇したため
2. **Why**: なぜDB接続が枯渇したのか？
   - Answer: バッチ処理が大量のコネクションを消費したため
3. **Why**: なぜバッチ処理が大量のコネクションを消費したのか？
   - Answer: コネクションのCloseを忘れていたため
4. **Why**: なぜCloseを忘れたのか？
   - Answer: レビュー時にチェック項目になかったため
5. **Why**: なぜチェック項目になかったのか？
   - Answer: コードレビューガイドラインが整備されていなかったため

---

## 5. 検知と対応 (Detection and Response)

### 良かった点 (What went well)
- アラートが自動で発火し、即座に検知できた
- オンコールエンジニアが迅速に対応開始した

### 改善点 (What could be improved)
- 原因特定に15分かかった (ログが分散していた)
- 復旧手順が明文化されておらず、手探りで対応した

---

## 6. 再発防止策 (Action Items)
<!-- SMART (Specific, Measurable, Achievable, Relevant, Time-bound) な形で -->

| Priority | アクション | 担当 | 期限 | ステータス |
| --- | --- | --- | --- | --- |
| High | バッチ処理のDB接続処理を見直し、接続のリユースとCloseを徹底 | Bob | MM/DD | 未着手 |
| High | DB接続数の監視アラート閾値を見直す (80%で警告) | Alice | MM/DD | 未着手 |
| Medium | 負荷試験を実施し、最適なプール設定値を再定義 | Carol | MM/DD | 未着手 |
| Medium | コードレビューガイドラインにリソース管理チェック項目を追加 | TechLead | MM/DD | 未着手 |
| Low | 障害対応手順書 (Runbook) の作成 | SRE Team | MM/DD | 未着手 |

---

## 7. 学び (Lessons Learned)
- [学び1]
- [学び2]
- [学び3]

---

## 8. フォローアップミーティング
- **日時**: YYYY/MM/DD HH:MM
- **参加者**: EM, TechLead, SRE, 関係エンジニア
- **アジェンダ**: アクションアイテムの進捗確認

---

## 9. 関連ドキュメント
- [インシデントチケット](link_to_jira)
- [Slack Thread](link_to_slack)
- [関連ADR](link)

---
