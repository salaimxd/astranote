# UI仕様：エディタ（MVP）

> デザインからエンジニアリングへのハンドオフドキュメント
> **利用職種**: Designer (主), PdM, Engineer

---

## 1. デザインリソース

### Figmaファイル

- **メインファイル**: [TBD]
- **プロトタイプ**: [TBD]
- **デザインスペック**: [TBD]

### アセット

- **アイコン**: [TBD]
- **フォント**: Noto Sans JP（Google Fonts）

---

## 2. 画面構成 (Layout)

### 基本レイアウト（3カラム）

```
┌────────────────────────────────────────────────────────────┐
│  [左サイドバー]   [中央エディタ]         [右サイドバー]     │
│  ┌──────────┐  ┌─────────────────┐  ┌──────────────┐     │
│  │エピソード │  │                 │  │スマホプレビュー│     │
│  │リスト    │  │  執筆エリア      │  │              │     │
│  │          │  │                 │  │              │     │
│  │第1話     │  │  タイプライター  │  │[375px幅]     │     │
│  │第2話 ●   │  │  スクロール      │  │              │     │
│  │第3話     │  │                 │  ├──────────────┤     │
│  │          │  │                 │  │執筆メモ      │     │
│  │[+新規]   │  │                 │  │              │     │
│  └──────────┘  └─────────────────┘  └──────────────┘     │
└────────────────────────────────────────────────────────────┘
```

### 幅の定義

| セクション | 幅 | 備考 |
| --- | --- | --- |
| 左サイドバー | 220px | 固定幅 |
| 中央エディタ | 可変（flex: 1） | 最小600px |
| 右サイドバー | 420px | 固定幅（プレビュー375px + パディング） |

---

## 3. 画面一覧 (Screen List)

| 画面ID | 画面名 | 説明 | 優先度 |
| --- | --- | --- | --- |
| SC-01 | メインエディタ画面 | 執筆のメイン画面 | High |
| SC-02 | 初回起動画面 | エピソードが0件の時の案内 | Medium |
| SC-03 | エラー表示（保存失敗） | IndexedDB保存失敗時 | High |

---

## 4. 詳細仕様

### 4.1 左サイドバー：エピソードリスト

#### レイアウト

- **背景色**: `#F9FAFB` (Gray 50)
- **パディング**: 16px
- **エピソード項目の高さ**: 48px

#### エピソード項目

| 状態 | 説明 | スタイル |
| --- | --- | --- |
| Default | 通常状態 | 背景: 透明、テキスト: Gray 700 |
| Hover | マウスオーバー時 | 背景: White、ボーダー: 1px solid Gray 200 |
| Active | 選択中 | 背景: Blue 50、テキスト: Blue 700、左ボーダー: 3px solid Blue 500 |
| Dragging | ドラッグ中 | 不透明度: 0.5、カーソル: grabbing |

#### 「新規エピソード」ボタン

- **位置**: サイドバー下部（固定）
- **スタイル**: ボーダー付きボタン（`border: 1px dashed Gray 300`）
- **ホバー**: 背景色: Gray 100

---

### 4.2 中央エディタ：執筆エリア

#### タイプライター・スクロール

- **固定位置**: 画面の上から40%の位置に現在の行を固定
- **スクロール動作**: ユーザーが入力すると、行が固定位置を維持するように自動スクロール
- **実装メモ**: `scrollIntoView({ behavior: 'smooth', block: 'center' })` を活用

#### テキストスタイル

| 要素 | フォント | サイズ | 行間 | カラー |
| --- | --- | --- | --- | --- |
| 本文 | Noto Sans JP | 16px | 1.8 (28.8px) | Gray 900 (#111827) |
| ルビ | Noto Sans JP | 10px | 1.2 | Gray 600 |
| 傍点 | - | - | - | - |

#### ルビ・傍点の表示

- **入力記法**: `｜文字《ルビ》` → 表示: <ruby>文字<rt style="font-size: 0.6em;">ルビ</rt></ruby>
- **プレビュー**: エディタ内でもルビを小さく表示（リアルタイム変換）
- **実装メモ**: Markdownパーサーをカスタマイズして `<ruby>` タグに変換

#### エディタの余白

- **パディング**: 左右 40px、上下 60px
- **最大幅**: 800px（中央揃え）

---

### 4.3 右サイドバー：プレビュー & メモ

#### スマホプレビューエリア

- **幅**: 375px（iPhone SE / 12 / 13 Pro相当）
- **背景色**: White
- **ボーダー**: 1px solid Gray 300
- **パディング**: 16px
- **高さ**: ビューポートの70%（可変）

##### プレビューのテキストスタイル

| 要素 | フォント | サイズ | 行間 | カラー |
| --- | --- | --- | --- | --- |
| 本文 | Noto Sans JP | 14px | 1.9 (26.6px) | Gray 900 |
| ルビ | Noto Sans JP | 9px | 1.2 | Gray 600 |

##### 改行ガイド

- **ルール**: 5行以上続く段落に警告アイコン表示
- **アイコン**: 黄色の警告マーク（`⚠️`）を段落の右側に表示
- **ツールチップ**: "スマホで読みにくい可能性があります（5行以上）"

#### 執筆メモエリア

- **位置**: プレビューの下部
- **高さ**: ビューポートの30%（可変、リサイズ可能）
- **背景色**: Yellow 50 (`#FEFCE8`)
- **ボーダー**: 上部のみ 1px solid Yellow 200
- **パディング**: 16px
- **テキストスタイル**: フォント: Noto Sans JP、サイズ: 13px、行間: 1.6、カラー: Gray 700

---

## 5. UIステータス定義 (UI States)

### エディタ入力エリア

| ステート | 説明 | デザイン | 実装メモ |
| --- | --- | --- | --- |
| Default | 通常状態 | 背景: White | - |
| Focus | フォーカス中 | ボーダー: なし | アウトライン削除 |
| Saving | 保存中（5秒ごと） | 右上に小さなスピナー表示 | 「保存中...」テキスト |
| Saved | 保存完了 | 右上に「✓ 保存済み」表示（1秒後に消える） | - |
| Error | 保存失敗 | 右上に「❌ 保存失敗」表示 | エラーメッセージ表示 |

---

## 6. レスポンシブ対応 (Responsive Design)

### ブレークポイント

| デバイス | 画面幅 | 対応内容 |
| --- | --- | --- |
| Desktop | 768px ~ | サイドバー常時表示（`relative` 位置） |
| Mobile/Tablet | ~ 767px | サイドバーをオーバーレイ表示（`fixed` 位置） |

### デスクトップ（768px以上）

#### レイアウト
- **左サイドバー**: 220px幅、`relative` 位置で常時表示
- **中央エディタ**: 可変幅（`flex-1`）
- **右サイドバー**: 現在は非表示（将来的に実装予定）

#### 挙動
- サイドバーはデフォルトで表示状態
- トグルボタンで表示/非表示を切り替え可能
- 非表示時は `hidden` クラスで完全に非表示

### モバイル/タブレット（~ 767px）

#### レイアウト
- **左サイドバー**: 280px幅、`fixed` 位置でオーバーレイ表示
- **中央エディタ**: 全画面表示（`w-full`）
- **オーバーレイ**: サイドバー開閉時に背景を暗くする半透明レイヤー

#### 初期状態
- サイドバー: 非表示（`-translate-x-full` で画面外に配置）
- エディタ: 全画面で表示

#### サイドバーの開閉

**開く動作**:
1. トグルボタンをタップ
2. サイドバーが左からスライドイン（`translate-x-0`）
3. 背景に半透明オーバーレイを表示（`bg-black bg-opacity-50`）

**閉じる動作**:
1. オーバーレイをタップ、または再度トグルボタンをタップ
2. サイドバーが左にスライドアウト（`-translate-x-full`）
3. オーバーレイが非表示になる

#### アニメーション
- **トランジション**: `transition-all duration-300`
- **イージング**: TailwindCSSデフォルト（ease）
- **スムーズな動き**: 300msでスライドイン/アウト

### z-index階層

| 要素 | z-index | 備考 |
| --- | --- | --- |
| オーバーレイ | 30 | モバイル時のみ表示 |
| サイドバー | 40 | オーバーレイの上層 |

### 実装上の注意点

#### SSR対応
- `typeof document !== 'undefined'` でブラウザ環境をチェック
- `window.innerWidth` で画面幅を判定（768px）

#### イベント管理
- オーバーレイクリックイベントは動的に追加/削除
- メモリリークを防ぐため、`removeEventListener` で適切にクリーンアップ

#### 集中モードとの連携
- 集中モード時は自動的にサイドバーを非表示
- DOM操作で `hidden` と `-translate-x-full` を追加

### 将来の拡張予定

- **右サイドバー（プレビュー）**: タブレットサイズでの表示最適化
- **スワイプジェスチャー**: タッチデバイスでのサイドバー開閉
- **メモエリア**: 画面下部にスライドインで表示

---

## 7. インタラクション・アニメーション

| 要素 | インタラクション | パラメータ |
| --- | --- | --- |
| エピソード項目のホバー | 背景色変化 | duration: 0.15s, easing: ease-out |
| エピソードのドラッグ | 不透明度変化 | opacity: 0.5 |
| 保存完了メッセージ | Fade-in & Fade-out | duration: 0.2s (in), 0.3s (out, 1秒後) |
| タイプライター・スクロール | スムーズスクロール | duration: 0.2s, easing: ease-in-out |

---

## 8. カラー (Colors)

| 用途 | カラー名 | HEX | RGB | 使用箇所 |
| --- | --- | --- | --- | --- |
| 背景（サイドバー） | Gray 50 | #F9FAFB | rgb(249, 250, 251) | 左右サイドバー |
| 背景（エディタ） | White | #FFFFFF | rgb(255, 255, 255) | 中央エディタ |
| テキスト（本文） | Gray 900 | #111827 | rgb(17, 24, 39) | エディタ本文 |
| テキスト（補助） | Gray 700 | #374151 | rgb(55, 65, 81) | エピソードリスト |
| テキスト（ルビ） | Gray 600 | #4B5563 | rgb(75, 85, 99) | ルビ |
| アクセント | Blue 500 | #3B82F6 | rgb(59, 130, 246) | 選択中の左ボーダー |
| メモ背景 | Yellow 50 | #FEFCE8 | rgb(254, 252, 232) | 執筆メモエリア |
| 警告 | Yellow 500 | #EAB308 | rgb(234, 179, 8) | 改行警告アイコン |
| エラー | Red 500 | #EF4444 | rgb(239, 68, 68) | エラーメッセージ |

参照: [Design System - Colors](../42.01_Design_System.md)

---

## 9. タイポグラフィ (Typography)

| 要素 | フォント | サイズ | 行間 | 太さ | カラー |
| --- | --- | --- | --- | --- | --- |
| エディタ本文 | Noto Sans JP | 16px | 1.8 | Regular (400) | Gray 900 |
| プレビュー本文 | Noto Sans JP | 14px | 1.9 | Regular (400) | Gray 900 |
| ルビ（エディタ） | Noto Sans JP | 10px | 1.2 | Regular (400) | Gray 600 |
| ルビ（プレビュー） | Noto Sans JP | 9px | 1.2 | Regular (400) | Gray 600 |
| エピソードタイトル | Noto Sans JP | 14px | 1.5 | Medium (500) | Gray 700 |
| 執筆メモ | Noto Sans JP | 13px | 1.6 | Regular (400) | Gray 700 |

参照: [Design System - Typography](../42.01_Design_System.md)

---

## 10. スペーシング (Spacing)

- **基本単位**: 8px
- **コンポーネント間**: 16px
- **セクション間**: 24px
- **パディング**:
  - エディタ: 左右 40px、上下 60px
  - サイドバー: 16px
  - プレビュー: 16px
  - メモ: 16px

参照: [Design System - Spacing](../42.01_Design_System.md)

---

## 11. ショートカットキー (Keyboard Shortcuts)

| ショートカット | 機能 | 説明 |
| --- | --- | --- |
| `Ctrl + S` | 保存（ダミー） | 「保存済み」メッセージを表示（実際は自動保存） |
| `Ctrl + K` | ルビ記法挿入 | `｜《》` を挿入し、カーソルを `《》` の間に移動 |
| `Ctrl + B` | 傍点記法挿入 | `《《》》` を挿入し、カーソルを `《《》》` の間に移動 |
| `Ctrl + N` | 新規エピソード | 左サイドバーに新しいエピソードを追加 |
| `Ctrl + ,` | 設定を開く | 設定モーダルを表示（v2以降） |
| `Ctrl + /` | ショートカット一覧 | ショートカットキーのヘルプを表示 |

### 実装メモ

- Mac環境では `Ctrl` → `Cmd` に自動変換
- ショートカットキーの衝突を避けるため、ブラウザのデフォルト動作を `preventDefault()` で無効化

---

## 12. アクセシビリティ (Accessibility)

### 色のコントラスト

- [ ] すべてのテキストがWCAG AA基準を満たしている（コントラスト比 4.5:1以上）
- [ ] エラー表示は色だけでなくアイコンも併用

### キーボード操作

- [ ] Tabキーで全ての操作可能要素にフォーカス移動できる
- [ ] Enterキーでエピソードを選択できる
- [ ] 矢印キーでエピソードリストを上下移動できる
- [ ] Escキーでモーダル（設定など）を閉じられる

### スクリーンリーダー

- [ ] エピソードリストに `role="list"` と `role="listitem"` を設定
- [ ] 保存状態のメッセージに `aria-live="polite"` を設定
- [ ] プレビューエリアに `aria-label="スマホ表示プレビュー"` を設定

---

## 13. エッジケース・エラー表示

### エラーケース一覧

| エラーケース | 表示内容 | UI | 補足 |
| --- | --- | --- | --- |
| IndexedDB保存失敗 | "保存に失敗しました。ブラウザのストレージ容量を確認してください。" | 右上に赤いエラーバナー | 「ローカル保存」ボタンを表示 |
| ローカル保存失敗 | "ダウンロードに失敗しました。もう一度お試しください。" | エラートースト（3秒） | リトライボタンを表示 |

### 空状態 (Empty State)

| 状態 | 表示内容 | UI |
| --- | --- | --- |
| エピソード0件 | "まだエピソードがありません。「新規エピソード」ボタンで執筆を開始しましょう。" | 中央エディタにメッセージ表示 |
| エピソードが空 | （プレースホルダーなし） | カーソル点滅のみ |

---

## 14. 実装メモ・注意事項

### エディタコンポーネント

- **ライブラリ候補**: `ContentEditable`、`Draft.js`、`Slate.js`、`TipTap`
- **注意1**: タイプライター・スクロールを実装するため、スクロール位置を制御できるライブラリを選択
- **注意2**: ルビの表示は `<ruby>` タグを使用し、カスタムパーサーで変換

### パフォーマンス

- **注意3**: 10万文字以上の原稿でも快適に動作させるため、仮想スクロール（Virtualization）の検討
- **注意4**: プレビューの更新は `debounce` を使用して100ms遅延

### データ保存

- **注意5**: 5秒ごとに自動保存（`setInterval` を使用）
- **注意6**: IndexedDBへの保存は非同期処理、エラーハンドリングを確実に実装

---

## 15. QAチェックリスト

### デスクトップ

- [ ] レイアウトが3カラムで正しく表示されるか
- [ ] タイプライター・スクロールが正しく動作するか
- [ ] ルビがエディタとプレビューで正しく表示されるか
- [ ] 保存状態のメッセージが正しく表示されるか

### モバイル

- [ ] エディタのみが全画面表示されるか
- [ ] プレビュー切り替えタブが正しく機能するか
- [ ] タッチ領域が十分か（44px x 44px以上）

### インタラクション

- [ ] エピソードのドラッグ&ドロップが正しく動作するか
- [ ] ショートカットキーが全て機能するか
- [ ] 改行警告が5行以上で表示されるか

---

## 16. 関連ドキュメント

- [PRD: MVP](../30_Definition_Requirements/31.01_PRD_MVP.md)
- [ADR: 技術スタック選定](../50_Engineering_Tech/52.01_ADR_Tech_Stack.md)
- [Design System](../42.01_Design_System.md)

---

## 17. 変更履歴

| 日付 | 変更者 | 変更内容 |
| --- | --- | --- |
| 2026-01-22 | Claude | 初版作成（MVP提案を基にUI仕様化） |
| 2026-01-25 | Claude | レスポンシブ対応の詳細仕様を更新（Phase 5.2実装完了に伴う） |
