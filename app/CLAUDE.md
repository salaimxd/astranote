# アプリケーション開発ガイドライン

このドキュメントは、アプリケーションコードを開発する際のルールと方針を定めたものです。

## 基本方針

- 特に指示がない限り、必ず**日本語**で回答・コミュニケーションを行う
- **仕様駆動開発（Specification-Driven Development）**を実践する
- 仕様書（`docs/` ディレクトリ）を唯一の信頼できる情報源（SSOT）とする

## 仕様駆動開発の実践

### 開発フロー

1. **仕様確認**：実装前に必ず `docs/` ディレクトリ内の関連仕様書を確認する
2. **仕様の更新**：仕様が不明確または不足している場合は、まず仕様書を更新する
3. **実装**：仕様書に基づいて実装を行う
4. **同期確認**：実装後、仕様と実装が乖離していないか確認する

### 原則

- **コードを書く前に仕様を書く**：仕様書が存在しない機能は実装しない
- **仕様と実装の同期**：実装の変更時は、必要に応じて仕様書も更新する
- **仕様の優先**：実装と仕様が矛盾する場合は、仕様を正とする（ただし、仕様が間違っている可能性も検討する）

## GitHub タスク管理

### マイルストーンと Issue

- 開発進捗は **GitHub マイルストーン** で管理する
- タスクは **GitHub Issue** として登録する
- マイルストーン一覧：`${GITHUB_REPO_URL}/milestones`
- Issue 一覧：`${GITHUB_REPO_URL}/issues`

> **注意**：`GITHUB_REPO_URL` は `.env` ファイルで設定します（例：`https://github.com/owner/repo`）。`.env.example` を参考に `.env` ファイルを作成してください。

### Issue 連携

- PR 説明文に `Closes #<issue>` または `Fixes #<issue>` を記載すると、マージ時に Issue が自動クローズされる
- コミットメッセージにも Issue 番号を含める：`feat(auth): ユーザー認証機能を追加 (#12)`
- PR テンプレート（`.github/pull_request_template.md`）を活用してレビュープロセスを標準化する

## ブランチ戦略

プロダクト開発のライフサイクルに対応した、以下のブランチ戦略を採用する。

| ブランチ             | 用途                       | タイミング       |
| -------------------- | -------------------------- | ---------------- |
| `main`               | 安定版、本番リリース       | リリース時       |
| `release/v*`         | **リリース準備・最終調整** | Milestone 完了時 |
| `develop`            | 開発統合                   | 機能完了時       |
| `feature/#<issue>-*` | 機能開発                   | Issue 単位       |
| `fix/#<issue>-*`     | バグ修正                   | Issue 単位       |
| `hotfix/#<issue>-*`  | 本番緊急修正               | 緊急時           |

### ブランチ命名例

```
feature/#12-user-authentication
fix/#15-login-bug
release/v1.1.0
hotfix/#20-security-patch
```

### 運用ルール

#### 品質チェック

`develop` へのマージ前に、必要な品質チェック（Lint / 型チェック / テスト等）を実施すること：

- **CI/CD が整備されている場合**：自動実行される品質チェックがすべてパスすることを確認
- **手動運用の場合**：ローカル環境で以下のコマンドを実行し、すべてパスすることを確認
  - `npm run lint`（または `bun run lint`）
  - `npm run type-check`（または `bun run type-check`）
  - `npm test`（または `bun test`）
  - 統合コマンドがある場合：`npm run preflight`（または `bun run preflight`）

#### リリース分離

- **リリース準備の分離**：`release/v*` ブランチでのリリース準備中も、`develop` で次期開発を継続できる体制を維持する
- **並行開発**：リリース準備が長期化する場合でも、新機能開発がブロックされないようにする

## コーディング規約

### セキュリティ

- 以下のような一般的な脆弱性を導入しないこと：
  - コマンドインジェクション
  - XSS（クロスサイトスクリプティング）
  - SQLインジェクション
  - OWASP Top 10 に記載されているその他の脆弱性
- セキュリティに関わる設定値（APIキー、トークン等）は環境変数で管理し、コードに直接書かない

### コード品質

- **シンプルさを優先**：過度な抽象化や将来への過剰な対応は避ける
- **必要最小限の変更**：要求された機能や修正に直接関係しない部分は変更しない
- **テスト可能性**：テストしやすいコード構造を心がける

### コメントとドキュメント

- 複雑なロジックには、なぜそのような実装になっているかを説明するコメントを追加する
- 自明なコードにはコメントを追加しない
- API の仕様や重要な型定義には JSDoc / TSDoc を追加する

## 開発環境

### 推奨ツール

- **パッケージマネージャー**：`bun` または `npm`
- **Linter**：ESLint、Prettier
- **型チェック**：TypeScript
- **テストフレームワーク**：プロジェクトで採用しているフレームワークに従う

### 環境変数

- `.env.example` をコピーして `.env` ファイルを作成する
- `.env` ファイルは Git に含めない（`.gitignore` に追加済み）
- 必要な環境変数は `.env.example` に記載し、チーム全体で共有する

## トラブルシューティング

### Issue を作成すべきケース

以下の場合は Issue を作成して記録する：

- バグを発見した場合
- 新機能のアイデアがある場合
- 仕様が不明確で、議論が必要な場合
- パフォーマンスの問題を発見した場合

### 緊急対応

本番環境で重大な問題が発生した場合：

1. まず問題を報告する（Issue 作成、チームへの通知）
2. `hotfix/#<issue>-*` ブランチを `main` から作成する
3. 最小限の修正を行う
4. 修正を `main` にマージし、即座にデプロイする
5. `develop` にも修正を反映する（チェリーピックまたはマージ）
